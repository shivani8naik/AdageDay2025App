{% extends "base.html" %}
{% block content %}

<section class="max-w-4xl mx-auto px-4 py-6">

  <!-- Page Title -->
  <div class="text-center mb-6">
    <h2 class="text-2xl font-bold text-[#008B94]">Event Memories</h2>
    <p class="text-xs text-gray-500">Relive the best moments from Adage Day</p>
  </div>

  <!-- Album Cards -->
  <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
    {% for title, media_files in album.items() %}
    <div class="cursor-pointer" onclick="toggleAlbum('{{ loop.index }}')">
      <!-- Album Cover Card -->
      <div class="relative group bg-gray-100 h-40 rounded-xl overflow-hidden shadow-sm hover:shadow-lg transition">
        {% if media_files %}
          <img src="{{ media_files[0] }}" class="w-full h-full object-cover group-hover:scale-105 transition" />
        {% else %}
          <div class="w-full h-full flex items-center justify-center text-gray-400 text-sm">
            üìÅ No Files
          </div>
        {% endif %}

        <div class="absolute bottom-0 inset-x-0 bg-black/40 text-white p-2 text-xs flex justify-between items-center">
          <span class="font-medium">{{ title }}</span>
          <span>{{ media_files|length }} üì∑</span>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Album Expanded View -->
  {% for title, media_files in album.items() %}
  <div id="album-{{ loop.index }}" class="hidden mt-6">
    <div class="flex justify-between items-center mb-3">
      <h3 class="text-lg font-semibold text-[#008B94]">{{ title }}</h3>
      <button onclick="toggleAlbum('{{ loop.index }}')" class="text-gray-500 text-sm">‚úñ Close</button>
    </div>

    {% if media_files %}
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
      {% for file in media_files %}

        {% if file.endswith('.mp4') or file.endswith('.mov') or file.endswith('.webm') %}
        <!-- Video Thumbnail -->
        <div class="rounded-xl overflow-hidden shadow bg-white">
          <video controls class="w-full h-40 rounded-lg">
            <source src="{{ file }}" type="video/mp4">
          </video>
        </div>

        {% else %}
        <!-- Image Card -->
        <div class="relative rounded-xl overflow-hidden shadow hover:shadow-lg transition">
          <img src="{{ file }}" loading="lazy"
               class="w-full h-40 object-cover rounded-lg cursor-pointer"
               onclick="openLightbox('{{ file }}', '{{ title }}')">
        </div>
        {% endif %}

      {% endfor %}
    </div>
    {% else %}
    <p class="text-center text-gray-500 text-sm mt-3">üì≠ No media uploaded yet for {{ title }}.</p>
    {% endif %}
  </div>
  {% endfor %}
  
</section>


<!-- Fullscreen Lightbox -->
<div id="lightbox" class="fixed inset-0 bg-black/90 flex items-center justify-center hidden z-50">
  <button onclick="closeLightbox()" class="absolute top-6 right-6 text-white text-2xl">‚úñ</button>
  <img id="lightbox-img" src="" class="max-w-full max-h-[75vh] rounded-lg shadow-lg">
  <button onclick="prevImage()" class="absolute left-5 text-white text-3xl">‚ùÆ</button>
  <button onclick="nextImage()" class="absolute right-5 text-white text-3xl">‚ùØ</button>
</div>


<script>
let currentIndex = 0;
let currentAlbum = [];
let slideshowInterval = null;

// Expand or Collapse Album
function toggleAlbum(id) {
  const album = document.getElementById("album-" + id);
  album.classList.toggle("hidden");
}

// Lightbox Functions
function openLightbox(src) {
  currentAlbum = Array.from(document.querySelectorAll(`img[src*='${src.split('/').slice(-2, -1)[0]}']`))
                      .map(img => img.src);

  currentIndex = currentAlbum.indexOf(src);
  document.getElementById("lightbox-img").src = src;
  document.getElementById("lightbox").classList.remove("hidden");
}

function closeLightbox() {
  document.getElementById("lightbox").classList.add("hidden");
}

function nextImage() {
  currentIndex = (currentIndex + 1) % currentAlbum.length;
  document.getElementById("lightbox-img").src = currentAlbum[currentIndex];
}

function prevImage() {
  currentIndex = (currentIndex - 1 + currentAlbum.length) % currentAlbum.length;
  document.getElementById("lightbox-img").src = currentAlbum[currentIndex];
}
</script>

{% endblock %}
